{"version":3,"sources":["scmjNetMgr.js"],"names":["scmjNetMgr","getNetCfg","require","addGameNet","key","gameMgr","reqCB","prepareNoticeMessage","bind","reqPCB","data","onUserEnterRoom","RoomOrder","exitRoomNoticeUserid","onDisbandRoomVoteIn","onDisbandRoomResultIn","OffLineNotice","OnLineNotice","Tiles","Cards","TileCount","i","playerList","initStartPai","zhuangNotify","WLMoPaiNotice","Card","Atile","ChuPaiNotice","optData","Ops","forEach","item","atile","Op","Combs","lastChuPaiID","push","toLocalOptType","Comb","showEatUI","cc","log","Opts","Math","pow","ChuPaiZuHeNotice","Type","setTimeout","ShowPaiNotify","BuPaiNotify","ZhanJiNoticeWl","TotalZhanJiWl","onPaiTimeChange","onReconnectDataWl","addChatNet","ChatUI","addReaNet","Reconnect","addRebNet","addMenuNet","menUI","gotoReady","handler","content","UserId","PlayerID","fun","net","send","exitOutRoom","dissolvedRoom","chuPai","rsp","RetCode","close","optPai","eatObj","dataIndex","pengOpt","huOpt","gangOpt","passOpt","chiPaiOpt","chiData","Data","gangType","VoteOutRoom","disbandRoomVote","module","exports","new"],"mappings":"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","file":"scmjNetMgr.js","sourceRoot":"../../../../../../../assets/mahjong/script/game/common","sourcesContent":["var scmjNetMgr = function () {\n    this.getNetCfg = function () {\n        return require(\"scMjCfg\");\n    }\n    this.addGameNet = function (key, gameMgr) {\n        this.reqCB(key, \"Ready\", gameMgr.prepareNoticeMessage.bind(gameMgr));\n        this.reqPCB(key, \"EnterRoom\", function (data) {\n            gameMgr.onUserEnterRoom(data, data.RoomOrder);\n        });\n        this.reqCB(key, \"LeaveRoom\", gameMgr.exitRoomNoticeUserid.bind(gameMgr))\n        this.reqCB(key, \"DisbandRoomVote\", gameMgr.onDisbandRoomVoteIn.bind(gameMgr));\n        this.reqCB(key, \"DisbandRoomResult\", gameMgr.onDisbandRoomResultIn.bind(gameMgr));\n        this.reqPCB(key, \"OffLine\", gameMgr.OffLineNotice.bind(gameMgr))\n        this.reqPCB(key, \"OnLine\", gameMgr.OnLineNotice.bind(gameMgr));\n        this.reqCB(key, \"FaPai\", function (data) {\n            data.Tiles = data.Cards;\n            data.TileCount = [];\n            for (let i in gameMgr.playerList) {\n                data.TileCount[i] = 16;\n            }\n            gameMgr.initStartPai(data);\n        })\n        this.reqCB(key, \"Zhuang\", gameMgr.zhuangNotify.bind(gameMgr));\n        this.reqCB(key, \"Mo\", gameMgr.WLMoPaiNotice.bind(gameMgr));\n        this.reqCB(key, \"Da\", function (data) {\n            //card 0 是提示某人可以打牌\n            if (!(data.Card == 0)) {\n                data.Atile = data.Card;\n                gameMgr.ChuPaiNotice(data);\n            }\n        });\n        this.reqCB(key, \"Ops\", function (data) {\n            var optData = [];\n            data.Ops.forEach(function (item) {\n                //吃牌本地获取，servar data  item.Combs不好获取\n                var atile = (item.Op == 64 || !item.Combs) ? gameMgr.lastChuPaiID : item.Combs[0][0]\n                optData.push({ Op: toLocalOptType[item.Op], Comb: item.Combs, Atile: atile });\n            })\n            gameMgr.showEatUI(optData);\n        })\n        this.reqCB(key, \"Peng\", function (data) {\n            cc.log(\"--this.reqCB(key, peng---\", data)\n            data.Atile = data.Card;\n            data.Opts = Math.pow(2, toLocalOptType[32]);\n            gameMgr.ChuPaiZuHeNotice(data);\n        })\n        this.reqCB(key, \"Gang\", function (data) {\n            data.Atile = data.Card;\n            data.Opts = Math.pow(2, toLocalOptType[data.Type]);\n            gameMgr.ChuPaiZuHeNotice(data);\n        })\n        this.reqCB(key, \"ShowPai\", function (data) {\n            setTimeout(function () {\n                gameMgr.ShowPaiNotify(data)\n            }, 1000)\n        });\n        this.reqCB(key, \"BuPai\", function (data) {\n            setTimeout(function () {\n                gameMgr.BuPaiNotify(data)\n            }, 1000)\n        })\n        this.reqCB(key, \"RoundAcc\", gameMgr.ZhanJiNoticeWl.bind(gameMgr))\n        this.reqCB(key, \"RoomAcc\", gameMgr.TotalZhanJiWl.bind(gameMgr));\n        this.reqCB(key, \"PaiTime\", gameMgr.onPaiTimeChange.bind(gameMgr));\n        //断线重连\n        this.reqCB(key, \"PaiJuInfo\", gameMgr.onReconnectDataWl.bind(gameMgr));\n    }\n\n    this.addChatNet = function (key, ChatUI) {\n\n    }\n    this.addReaNet = function (key, Reconnect) {\n\n    }\n    this.addRebNet = function (key, Reconnect) {\n\n    }\n    this.addMenuNet = function (key, menUI) {\n        // this.reqCB(key, \"DisbandRoomResult\", menUI.DisbandRoomResultWL.bind(menUI));\n    }\n\n    //*************------------------------------send to server --------------------***************//\n    this.gotoReady = function (data, handler) {\n        var content = {}\n        content.UserId = data.PlayerID;\n        fun.net.send(\"Ready\", {}, handler);\n    }\n    this.exitOutRoom = function (data, handler) {\n        fun.net.send(\"LeaveRoom\", data, handler);\n    }\n    this.dissolvedRoom = function (data, handler) {\n        this.exitOutRoom({}, handler);\n    };\n\n    this.chuPai = function (data) {\n        var content = { Card: data.Atile };\n        fun.net.send(\"Da\", content, function (rsp) {\n            //打出的牌与服务器对不上\n            //26非法操作\n            //30 打出牌不能为特殊牌\n            if (rsp && (rsp.RetCode == 26 || rsp.RetCode == 30)) {\n                fun.net.close();\n            }\n        });\n    }\n\n    this.optPai = function (content, eatObj) {\n        if (eatObj.dataIndex == toLocalOptType[32]) {\n            this.pengOpt(content);\n        }\n        if (eatObj.dataIndex == toLocalOptType[1] ||\n            eatObj.dataIndex == toLocalOptType[2]) {\n            this.huOpt(content);\n        }\n        if (eatObj.dataIndex == toLocalOptType[4]) {\n            this.gangOpt(content, 4)\n        }\n        if (eatObj.dataIndex == toLocalOptType[8]) {\n            this.gangOpt(content, 8)\n        }\n        if (eatObj.dataIndex == toLocalOptType[16]) {\n            this.gangOpt(content, 16)\n        }\n    }\n\n    this.passOpt = function () {\n        fun.net.send(\"Pass\", {});\n    }\n    this.pengOpt = function (data) {\n        fun.net.send(\"Peng\", { Card: data.Atile })\n    }\n    this.chiPaiOpt = function (chiData) {\n        var content = { Comb: chiData.Data }\n        fun.net.send(\"Chi\", content)\n    }\n    this.huOpt = function (data) {\n        fun.net.send(\"Hu\", { Card: data.Atile });\n    }\n    this.gangOpt = function (data, gangType) {\n        fun.net.send(\"Gang\", { Type: gangType, Card: data.Atile });\n    }\n    this.VoteOutRoom = function (data, handler) {\n        fun.net.send('DisbandRoomVote', data, handler);\n    }\n    this.disbandRoomVote = function (data, handler) {\n        fun.net.send('DisbandRoomVote', data, handler);\n    }\n}\n\nmodule.exports = {\n    new: function () {\n        return scmjNetMgr;\n    }\n};"]}