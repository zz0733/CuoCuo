<<<<<<< HEAD
{"version":3,"sources":["hallShare.js"],"names":["Audio","require","HuoDongResult","cc","Enum","TransformGameType","ExchangeResult","Class","extends","Component","properties","onLoad","bg","node","getChildByName","i","on","onBtnShareClick","onBtnCloseClick","onBtnExchangeClick","bind","checkRoomCard","animation","getComponent","Animation","clips","getClips","_leftTicket","Label","fun","event","add","result","csv","getHuoDong","huodong","net","pSend","Type","parseInt","INT_Type","data","SUCCESS","dispatch","contentStr","Delta","string","SUCCESSED","onDestroy","remove","GameType","gameConst","gameType","maJiangHuangYan","TollCardCnt","undefined","btnGame1","maJiangWenLing","btnGame2","btnGame3","setLeftTicket","num","playEffect","WxShareCircle","gameTypeCN","gameTypeZhNameMap","content","okCb","itemCsv","voucher","nowCnt","itemCnt","contentSuc","cardsCnt","length","initNum","onEnable","play","name","once","destroy"],"mappings":"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","file":"hallShare.js","sourceRoot":"../../../../../../assets/hall/script/hall","sourcesContent":["let Audio = require('Audio');\nconst HuoDongResult = cc.Enum({\n    'FAILED':    0, //失败\n    'SUCCESS':   1, //成功\n    'EXPIRED':   2, //过期\n    'WAITING':   3, //未开启\n    'MISS':      4, //不存在\n    'SUCCESSED': 5, //已完成\n});\nconst TransformGameType = [3, 1, 5];//3-黄岩 5-挖花 1-温岭\nconst ExchangeResult = cc.Enum({\n    'FAIL':    0, //失败\n    'SUCCESS': 1, //成功\n    'NOWAY':   2, //无法兑换\n    'LACKOFF': 3, //物品不足\n});\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n\n    },\n\n    onLoad () {\n        let bg = this.node.getChildByName('back');\n        for(let i=0; i<3; ++i){\n            this['btnGame'+(i+1)] = bg.getChildByName('btnGame' + (i+1));\n        }\n        bg.getChildByName('btnShare').on('click', this.onBtnShareClick, this);\n        bg.getChildByName('btnClose').on('click', this.onBtnCloseClick, this);\n        for(let i = 0; i < 3; ++i){\n            bg.getChildByName('btnGame'+(i+1)).on('click', this.onBtnExchangeClick.bind(this, TransformGameType[i]));\n        }\n\n        this.checkRoomCard();\n        \n        this.animation = this.node.getComponent(cc.Animation);\n        this.clips = this.animation.getClips();\n\n        this._leftTicket = bg.getChildByName('leftTicket').getComponent(cc.Label);\n        fun.event.add('ShareWeChatShareResult', 'PhoneWeChatShareResult', function(result){\n            if (result) {\n                fun.csv.getHuoDong('day_share', function(huodong){\n                    fun.net.pSend('HuoDong', {Type: parseInt(huodong.INT_Type)}, function(data){\n                        if (data.result === HuoDongResult.SUCCESS) {\n                            fun.event.dispatch('MinSingleButtonPop', {contentStr: '获得房卡兑换券 '+data.Delta+' 张'});\n                            this._leftTicket.string = parseInt(this._leftTicket.string) + data.Delta;\n                        } else if (data.result === HuoDongResult.SUCCESSED)\n                            fun.event.dispatch('MinSingleButtonPop', {contentStr: '今日已完成分享获得房卡兑换券活动！'});\n                        else\n                            fun.event.dispatch('MinSingleButtonPop', {contentStr: '获取房卡兑换券失败！'});\n                    }.bind(this));\n                }.bind(this));\n            }\n        }.bind(this));\n    },\n\n    onDestroy () {\n        fun.event.remove('ShareWeChatShareResult');\n    },\n\n    checkRoomCard () {\n        fun.net.pSend('RoomCard', {GameType: gameConst.gameType.maJiangHuangYan}, function(data) {\n            if (data.TollCardCnt !== undefined) {\n                this.btnGame1.getChildByName('num').getComponent(cc.Label).string = data.TollCardCnt;\n            }\n            fun.net.pSend('RoomCard', {GameType: gameConst.gameType.maJiangWenLing}, function(data) {\n                if (data.TollCardCnt !== undefined) {\n                    this.btnGame2.getChildByName('num').getComponent(cc.Label).string = data.TollCardCnt;\n                }\n            }.bind(this));\n        }.bind(this));\n        this.btnGame3.getChildByName('num').getComponent(cc.Label).string = 0;\n    },\n\n    setLeftTicket (num) {\n        this._leftTicket.string = num;\n    },\n\n    onBtnShareClick () {\n        Audio.playEffect('hall', 'button_nomal.mp3');\n        require('JSPhoneWeChat').WxShareCircle();\n    },\n\n    onBtnExchangeClick (gameType) {\n        if (gameType === 5) {\n            fun.event.dispatch('MinSingleButtonPop', {contentStr: '暂未开放兑换功能, 敬请期待！'});\n            return;\n        }\n        if(parseInt(this._leftTicket.string) <= 0){\n            fun.event.dispatch('MinSingleButtonPop', {contentStr: '房卡兑换券不足，请分享朋友圈获得房卡兑换券！'});\n            return;\n        }\n        let gameTypeCN = gameConst.gameTypeZhNameMap[gameType];\n        let content = '您是否要将所有的房卡兑换券兑换成 ' + gameTypeCN + ' 的房卡？';\n        let okCb = function(){\n            fun.net.pSend('ExchgGood', {Type: gameConst.itemCsv.voucher, GameType: gameType}, function(data){\n                if(data.result === ExchangeResult.SUCCESS){\n                    let nowCnt = parseInt(this._leftTicket.string) - data.itemCnt;\n                    this._leftTicket.string = nowCnt < 0 ? 0 : nowCnt;\n                    let contentSuc = '使用了 '+data.itemCnt+' 房卡兑换券兑换了 '+data.cardsCnt+' 张 '+gameTypeCN+' 房卡';\n                    fun.event.dispatch('MinSingleButtonPop', {contentStr: contentSuc});\n                    for (let i=0; i<TransformGameType.length; ++i) {\n                        if (TransformGameType[i] === gameType) {\n                            let initNum = this['btnGame'+(i+1)].getChildByName('num').getComponent(cc.Label).string;\n                            this['btnGame'+(i+1)].getChildByName('num').getComponent(cc.Label).string = initNum + data.cardsCnt;\n                        }\n                    }\n                }else{\n                    fun.event.dispatch('MinSingleButtonPop', {contentStr: '兑换房卡失败！'});\n                }\n            }.bind(this));\n        }.bind(this);\n        fun.event.dispatch('MinSingleButtonPop', {contentStr: content, okCb: okCb});\n    },\n\n    onEnable () {\n        this.animation.play(this.clips[0].name);\n    },\n\n    onBtnCloseClick () {\n        Audio.playEffect('hall', 'button_close.mp3');\n        this.animation.play(this.clips[1].name).once('finished', function () {\n            this.node.destroy();\n        }, this);\n    },\n\n});\n"]}
=======
{"version":3,"sources":["hallShare.js"],"names":["Audio","require","HuoDongResult","cc","Enum","TransformGameType","ExchangeResult","Class","extends","Component","properties","onLoad","bg","node","getChildByName","i","on","onBtnShareClick","onBtnCloseClick","onBtnExchangeClick","bind","checkRoomCard","animation","getComponent","Animation","clips","getClips","_leftTicket","Label","fun","event","add","result","csv","getHuoDong","huodong","net","pSend","Type","parseInt","INT_Type","data","SUCCESS","dispatch","contentStr","Delta","string","SUCCESSED","onDestroy","remove","GameType","gameConst","gameType","maJiangHuangYan","TollCardCnt","undefined","Total","btnGame1","maJiangWenLing","btnGame2","btnGame3","setLeftTicket","num","playEffect","WxShareCircle","gameTypeCN","gameTypeZhNameMap","content","okCb","itemCsv","voucher","nowCnt","itemCnt","contentSuc","cardsCnt","length","initNum","onEnable","play","name","once","destroy"],"mappings":"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","file":"hallShare.js","sourceRoot":"../../../../../../assets/hall/script/hall","sourcesContent":["let Audio = require('Audio');\nconst HuoDongResult = cc.Enum({\n    'FAILED':    0, //失败\n    'SUCCESS':   1, //成功\n    'EXPIRED':   2, //过期\n    'WAITING':   3, //未开启\n    'MISS':      4, //不存在\n    'SUCCESSED': 5, //已完成\n});\nconst TransformGameType = [3, 1, 5];//3-黄岩 5-挖花 1-温岭\nconst ExchangeResult = cc.Enum({\n    'FAIL':    0, //失败\n    'SUCCESS': 1, //成功\n    'NOWAY':   2, //无法兑换\n    'LACKOFF': 3, //物品不足\n});\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n\n    },\n\n    onLoad () {\n        let bg = this.node.getChildByName('back');\n        for(let i=0; i<3; ++i){\n            this['btnGame'+(i+1)] = bg.getChildByName('btnGame' + (i+1));\n        }\n        bg.getChildByName('btnShare').on('click', this.onBtnShareClick, this);\n        bg.getChildByName('btnClose').on('click', this.onBtnCloseClick, this);\n        for(let i = 0; i < 3; ++i){\n            bg.getChildByName('btnGame'+(i+1)).on('click', this.onBtnExchangeClick.bind(this, TransformGameType[i]));\n        }\n\n        this.checkRoomCard();\n        \n        this.animation = this.node.getComponent(cc.Animation);\n        this.clips = this.animation.getClips();\n\n        this._leftTicket = bg.getChildByName('leftTicket').getComponent(cc.Label);\n        fun.event.add('ShareWeChatShareResult', 'PhoneWeChatShareResult', function(result){\n            if (result) {\n                fun.csv.getHuoDong('day_share', function(huodong){\n                    fun.net.pSend('HuoDong', {Type: parseInt(huodong.INT_Type)}, function(data){\n                        if (data.result === HuoDongResult.SUCCESS) {\n                            fun.event.dispatch('MinSingleButtonPop', {contentStr: '获得房卡兑换券 '+data.Delta+' 张'});\n                            this._leftTicket.string = parseInt(this._leftTicket.string) + data.Delta;\n                        } else if (data.result === HuoDongResult.SUCCESSED)\n                            fun.event.dispatch('MinSingleButtonPop', {contentStr: '今日已完成分享获得房卡兑换券活动！'});\n                        else\n                            fun.event.dispatch('MinSingleButtonPop', {contentStr: '获取房卡兑换券失败！'});\n                    }.bind(this));\n                }.bind(this));\n            }\n        }.bind(this));\n    },\n\n    onDestroy () {\n        fun.event.remove('ShareWeChatShareResult');\n    },\n\n    checkRoomCard () {\n        fun.net.pSend('RoomCard', {GameType: gameConst.gameType.maJiangHuangYan}, function(data) {\n            if (data.TollCardCnt !== undefined || data.Total) {\n                this.btnGame1.getChildByName('num').getComponent(cc.Label).string = data.TollCardCnt || data.Total;\n            }\n            fun.net.pSend('RoomCard', {GameType: gameConst.gameType.maJiangWenLing}, function(data) {\n                if (data.TollCardCnt !== undefined || data.Total) {\n                    this.btnGame2.getChildByName('num').getComponent(cc.Label).string = data.TollCardCnt || data.Total;\n                }\n            }.bind(this));\n        }.bind(this));\n        this.btnGame3.getChildByName('num').getComponent(cc.Label).string = 0;\n    },\n\n    setLeftTicket (num) {\n        this._leftTicket.string = num;\n    },\n\n    onBtnShareClick () {\n        Audio.playEffect('hall', 'button_nomal.mp3');\n        require('JSPhoneWeChat').WxShareCircle();\n    },\n\n    onBtnExchangeClick (gameType) {\n        if (gameType === 5) {\n            fun.event.dispatch('MinSingleButtonPop', {contentStr: '暂未开放兑换功能, 敬请期待！'});\n            return;\n        }\n        if(parseInt(this._leftTicket.string) <= 0){\n            fun.event.dispatch('MinSingleButtonPop', {contentStr: '房卡兑换券不足，请分享朋友圈获得房卡兑换券！'});\n            return;\n        }\n        let gameTypeCN = gameConst.gameTypeZhNameMap[gameType];\n        let content = '您是否要将所有的房卡兑换券兑换成 ' + gameTypeCN + ' 的房卡？';\n        let okCb = function(){\n            fun.net.pSend('ExchgGood', {Type: gameConst.itemCsv.voucher, GameType: gameType}, function(data){\n                if(data.result === ExchangeResult.SUCCESS){\n                    let nowCnt = parseInt(this._leftTicket.string) - data.itemCnt;\n                    this._leftTicket.string = nowCnt < 0 ? 0 : nowCnt;\n                    let contentSuc = '使用了 '+data.itemCnt+' 房卡兑换券兑换了 '+data.cardsCnt+' 张 '+gameTypeCN+' 房卡';\n                    fun.event.dispatch('MinSingleButtonPop', {contentStr: contentSuc});\n                    for (let i=0; i<TransformGameType.length; ++i) {\n                        if (TransformGameType[i] === gameType) {\n                            let initNum = this['btnGame'+(i+1)].getChildByName('num').getComponent(cc.Label).string;\n                            this['btnGame'+(i+1)].getChildByName('num').getComponent(cc.Label).string = initNum + data.cardsCnt;\n                        }\n                    }\n                }else{\n                    fun.event.dispatch('MinSingleButtonPop', {contentStr: '兑换房卡失败！'});\n                }\n            }.bind(this));\n        }.bind(this);\n        fun.event.dispatch('MinSingleButtonPop', {contentStr: content, okCb: okCb});\n    },\n\n    onEnable () {\n        this.animation.play(this.clips[0].name);\n    },\n\n    onBtnCloseClick () {\n        Audio.playEffect('hall', 'button_close.mp3');\n        this.animation.play(this.clips[1].name).once('finished', function () {\n            this.node.destroy();\n        }, this);\n    },\n\n});\n"]}
>>>>>>> f8a5a6134d18df4ab898a5e431e5f0b36bc013ac
