{"version":3,"sources":["../../../../../../assets/hall/script/public/assets/hall/script/public/chat.js"],"names":["Audio","require","cc","Class","extends","Component","properties","onLoad","userId","fun","db","getData","UserId","bg","node","getChildByName","emojiList","i","childrenCount","on","onEmojiClick","bind","textScroll","textList","gameType","GameType","exporText","length","getComponent","ScrollView","vertical","text","active","content","Label","string","onTextClick","onBtnCloseClick","animation","Animation","clips","getClips","onEnable","play","name","index","sendChat","chatType","from","sData","playEffect","net","pSend","msg","once","destroy"],"mappings":"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","file":"chat.js","sourceRoot":"../../../../../../assets/hall/script/public","sourcesContent":["let Audio = require('Audio');\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n\n    },\n\n    onLoad () {\n        this.userId = fun.db.getData('UserInfo').UserId;\n        let bg = this.node.getChildByName('back');\n        let emojiList = bg.getChildByName('emojiList');\n        for (let i = 0; i < emojiList.childrenCount; i++) {\n            emojiList.getChildByName(\"emoji\" + i).on('click', this.onEmojiClick.bind(this, i));\n        }\n        let textScroll = bg.getChildByName('textList');\n        let textList = textScroll.getChildByName('view').getChildByName('content');\n        let gameType = fun.db.getData('RoomInfo').GameType;\n        let exporText = require('ChatCfg').exporText[gameType];\n        if (exporText.length > 8) {\n            textScroll.getComponent(cc.ScrollView).vertical = true;\n        } else {\n            textScroll.getComponent(cc.ScrollView).vertical = false;\n        }\n        for (let i = 0; i < exporText.length; i++) {\n            let text = textList.getChildByName(\"text\" + i);\n            text.active = true;\n            let content = text.getChildByName('content').getComponent(cc.Label);\n            content.string = exporText[i];\n            text.on('click', this.onTextClick.bind(this, i));\n        }\n        bg.getChildByName('btnClose').on('click', this.onBtnCloseClick, this);\n        this.node.getChildByName('hitzone').on('click', this.onBtnCloseClick, this);\n\n        this.animation = this.node.getComponent(cc.Animation);\n        this.clips = this.animation.getClips();\n    },\n\n    onEnable () {\n        this.animation.play(this.clips[0].name);\n    },\n\n    onEmojiClick (index) {\n        this.sendChat({chatType: 'emoji', index: index, from: this.userId});\n    },\n\n    onTextClick (index) {\n        this.sendChat({chatType: 'text', index: index, from: this.userId})\n    },\n\n    sendChat(sData){\n        Audio.playEffect('hall', 'button_nomal.mp3');\n        fun.net.pSend('Chat', sData);\n         //prevent too fast\n        this.onBtnCloseClick(true);\n    },\n\n    onBtnCloseClick (msg) {\n        if(!msg){\n            Audio.playEffect('hall', 'button_close.mp3');\n        }\n        this.animation.play(this.clips[1].name).once('finished', function () {\n            this.node.destroy();\n        }, this);\n    }\n});\n"]}