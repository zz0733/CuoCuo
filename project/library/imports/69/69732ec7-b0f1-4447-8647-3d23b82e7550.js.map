{"version":3,"sources":["../../../../../../assets/hall/script/fun/assets/hall/script/fun/initFun.js"],"names":["window","gameConst","require","chatCfg","funNetMgr","JSPhoneVoice","cc","Class","extends","Component","properties","loginUrl","type","loginUrlType","default","intranet","displayName","loginType","weChat","enableUpdate","voiceLanguage","mandarin","soundValume","min","max","musicValume","enableAutoLogin","logUrl","logLevel","info","logSaveDay","compileType","custom","tooltip","releaseType","normal","onLoad","sumdt","currTime","Date","now","announceInfo","logger","fun","gameCfg","gameVersion","netDelayTime","key","compileContent","apple","release","extranet","fisher","log","bind","base64","event","db","setData","utils","csv","net","getNeedNotice","setNeedNotice","rootNode","node","game","addPersistRootNode","addOpenCb","pListen","sys","localStorage","removeItem","setState","data","contentStr","okBtnStr","closeBtnStr","okCb","restart","closeCb","endGame","dispatch","chatType","content","exporText","getData","GameType","index","emoji","voiceName","from","isNative","writeVoiceData","userInfo","RoomCard","CurrRoomCardNum","List","Dels","forEach","value","i","length","id","splice","Adds","noSuper","superIdx","undefined","concat","mId","mailInfo","set","dispatchData","_showState","on","EVENT_HIDE","_gameHide","EVENT_SHOW","_gameShow","director","setDisplayStats","_checkArrayFunc","update","dt","flag","end_time","onDestroy","off","sendHeartBeat","audioEngine","pauseMusic","resumeAll","Array","prototype","findIndex","Object","defineProperty","predicate","TypeError","o","len","thisArg","arguments","k","kValue","call"],"mappings":"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","file":"initFun.js","sourceRoot":"../../../../../../assets/hall/script/fun","sourcesContent":["window.gameConst = require(\"GameCfg\");\r\nconst chatCfg = require('ChatCfg');\r\nconst funNetMgr = require('funNetMgr');\r\nconst JSPhoneVoice = require('JSPhoneVoice');\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n\r\n        loginUrl: {\r\n            type: gameConst.loginUrlType,\r\n            default: gameConst.loginUrlType.intranet,\r\n            displayName: '登陆服务器地址',\r\n        },\r\n\r\n        loginType: {\r\n            type: gameConst.loginType,\r\n            default: gameConst.loginType.weChat,\r\n            displayName: '登陆类型',\r\n        },\r\n\r\n        enableUpdate: {\r\n            default: true,\r\n            displayName: '启用热更新',\r\n        },\r\n\r\n        voiceLanguage: {\r\n            type: gameConst.voiceLanguage,\r\n            default: gameConst.voiceLanguage.mandarin,\r\n            displayName: '用户默认语音',\r\n        },\r\n\r\n        soundValume: {\r\n            default: 0.8,\r\n            min: 0,\r\n            max: 1,\r\n            displayName: '默认音效音量',\r\n        },\r\n\r\n        musicValume: {\r\n            default: 0.8,\r\n            min: 0,\r\n            max: 1,\r\n            displayName: '默认音乐音量',\r\n        },\r\n\r\n        enableAutoLogin: {\r\n            default: true,\r\n            displayName: '启用自动登陆'\r\n        },\r\n\r\n        logUrl: {\r\n            default: \"ws://192.168.1.89:6868/websocket\",\r\n            displayName: '提交日志地址',\r\n        },\r\n\r\n        logLevel: {\r\n            type: gameConst.logLevel,\r\n            default: gameConst.logLevel.info,\r\n            displayName: '日志级别',\r\n        },\r\n\r\n        logSaveDay: {\r\n            default: 3,\r\n            displayName: '日志保存天数',\r\n        },\r\n\r\n        compileType: {\r\n            default: gameConst.compileType.custom,\r\n            type: gameConst.compileType,\r\n            displayName: '编译配置',\r\n            tooltip: 'custom：上面选项生效;其他选项将覆盖上面的配置',\r\n        },\r\n\r\n        releaseType: {\r\n            type: gameConst.releaseType,\r\n            default: gameConst.releaseType.normal,\r\n            displayName: '发布方式',\r\n        }\r\n    },\r\n\r\n    onLoad () {\r\n        this.sumdt = 0;\r\n        this.currTime = Date.now();\r\n        this.announceInfo = [];\r\n        const logger = require(\"funLog\");\r\n        window.fun = {\r\n            gameCfg: {\r\n                loginUrl: gameConst.loginUrl[this.loginUrl],\r\n                logUrl: this.logUrl,\r\n                loginType: this.loginType,\r\n                enableAutoLogin: this.enableAutoLogin,\r\n                logLevel: this.logLevel,\r\n                logSaveDay: this.logSaveDay,\r\n                enableUpdate: this.enableUpdate,\r\n                voiceLanguage: this.voiceLanguage.mandarin,\r\n                soundValume: this.soundValume,\r\n                musicValume: this.musicValume,\r\n                gameVersion: 0,\r\n                releaseType: this.releaseType,\r\n                netDelayTime: 0,\r\n            },\r\n        };\r\n        if (this.compileType > gameConst.compileType.custom) {\r\n            for (const key in gameConst.compileContent[this.compileType]) {\r\n                fun.gameCfg[key] = gameConst.compileContent[this.compileType][key];\r\n            }\r\n        }\r\n        switch (fun.gameCfg.releaseType) {\r\n            case gameConst.releaseType.apple:\r\n                fun.gameCfg.loginUrl = gameConst.loginUrl[gameConst.loginUrlType.apple];\r\n                break;\r\n            case gameConst.releaseType.release:\r\n                fun.gameCfg.loginUrl = gameConst.loginUrl[gameConst.loginUrlType.extranet];\r\n                break;\r\n            case gameConst.releaseType.fisher:\r\n                fun.gameCfg.loginUrl = gameConst.loginUrl[gameConst.loginUrlType.fisher];\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n        fun.logger = new logger();\r\n        fun.log = fun.logger.log.bind(fun.logger);\r\n        fun.base64 = require(\"funBase64\");\r\n        fun.event = require(\"funEvent\");\r\n        fun.db = require(\"funDB\");\r\n        fun.db.setData('UpdatedGame', {});\r\n        fun.db.setData('MailInfo', {});\r\n        fun.db.setData('AnnounceInfo', []);\r\n        fun.db.setData('NewMailId', -1);\r\n        fun.utils = require('funUtils');\r\n        fun.csv = require('funCsv');\r\n        fun.net = new funNetMgr();\r\n        if (!fun.db.getNeedNotice()) {\r\n            fun.db.setNeedNotice(false);\r\n        }\r\n\r\n        fun.rootNode = this.node;\r\n        cc.game.addPersistRootNode(fun.rootNode);\r\n\r\n        fun.net.addOpenCb(function () {\r\n            fun.net.pListen('KickOff', function () {\r\n                cc.sys.localStorage.removeItem('Token');\r\n                fun.net.setState('KickOff');\r\n                let data = {\r\n                    contentStr: '账号在其它设备登录，请确认是否本人操作！',\r\n                    okBtnStr: '重试',\r\n                    closeBtnStr: '退出',\r\n                    okCb () {\r\n                        fun.utils.restart();\r\n                    },\r\n                    closeCb () {\r\n                        fun.utils.endGame();\r\n                    }\r\n                };\r\n                fun.event.dispatch('MinDoubleButtonPop', data);\r\n            });\r\n        });\r\n\r\n        fun.net.addOpenCb(function () {\r\n           fun.net.pListen('Chat', function (data) {\r\n                switch (data.chatType) {\r\n                    case 'text':\r\n                        data.content = chatCfg.exporText[fun.db.getData('RoomInfo').GameType][data.index];\r\n                        break;\r\n                    case 'emoji':\r\n                        data.content = chatCfg.emoji[data.index];\r\n                        break;\r\n                    case 'voice':\r\n                        const voiceName = Date.now() + \"_\" + data.from;\r\n                        if(cc.sys.isNative ) {\r\n                            JSPhoneVoice.writeVoiceData(data.content, voiceName);\r\n                        } \r\n                        data.content = voiceName;\r\n                        break;\r\n                }\r\n                fun.event.dispatch('RoomChat', data);\r\n           });\r\n        });\r\n\r\n        fun.net.addOpenCb(function () {\r\n            fun.net.pListen('RoomCard', function (data) {\r\n                let userInfo = fun.db.getData('UserInfo');\r\n                userInfo.RoomCard = data.CurrRoomCardNum;\r\n                fun.db.setData('UserInfo', userInfo);\r\n            });\r\n        });\r\n\r\n        fun.net.addOpenCb(function () {\r\n            fun.net.pListen('Announce', function (data) {\r\n                if (data.List) {\r\n                    this.announceInfo = data.List;\r\n                    fun.db.setData('AnnounceInfo', data.List);\r\n                } else {\r\n                    let announceInfo = fun.db.getData('AnnounceInfo');\r\n                    if (data.Dels) {\r\n                        data.Dels.forEach(function(value) {\r\n                            for (let i = 0; i < announceInfo.length; i++) {\r\n                                if (announceInfo[i].id === value) {\r\n                                    announceInfo.splice(i, 1);\r\n                                    break;\r\n                                }\r\n                            }\r\n                        });\r\n                    }\r\n                    if (data.Adds) {\r\n                        let noSuper = true, superIdx = undefined;\r\n                        for(let i=0; i<announceInfo.length; ++i){\r\n                            if (announceInfo[i].type !== 11) {\r\n                                noSuper = false;\r\n                                superIdx = i;\r\n                            }\r\n                        }\r\n                        if (noSuper) {\r\n                            announceInfo = announceInfo.concat(data.Adds);\r\n                        } else {\r\n                            announceInfo[superIdx] = data.Adds;\r\n                        }\r\n                    }\r\n                    this.announceInfo = announceInfo;\r\n                    fun.db.setData('AnnounceInfo', announceInfo);\r\n                }\r\n            }.bind(this));\r\n        }.bind(this));\r\n\r\n        fun.net.addOpenCb(function () {\r\n            fun.net.pListen('NewMailId', function (data) {\r\n                fun.db.setData('NewMailId', data.mId);\r\n            });\r\n        });\r\n\r\n        fun.net.addOpenCb(function () {\r\n            fun.net.pListen('NewMail', function (data) {\r\n                let mailInfo = db.getData('MailInfo');\r\n                mailInfo[data.id] = data;\r\n                fun.db.set('MailInfo', mailInfo);\r\n            })\r\n        });\r\n\r\n        fun.net.addOpenCb(function () {\r\n            fun.net.pListen('ServerError', function (data) {\r\n                let dispatchData = {\r\n                    okBtnStr: '关闭游戏',\r\n                    contentStr: '与游戏服务器断开连接！',\r\n                    okCb () {\r\n                        fun.utils.endGame();\r\n                    },\r\n                    closeCb () {\r\n                        fun.utils.endGame();\r\n                    },\r\n                };\r\n                fun.event.dispatch('MinSingleButtonPop', dispatchData);\r\n            })\r\n        });\r\n        this._showState = true;\r\n        cc.game.on(cc.game.EVENT_HIDE, this._gameHide, this);\r\n        cc.game.on(cc.game.EVENT_SHOW, this._gameShow, this);\r\n        cc.director.setDisplayStats(false);\r\n        this._checkArrayFunc();\r\n    },\r\n\r\n    update(dt) {\r\n        fun.net.update(dt);\r\n        this.sumdt += dt;\r\n        if (this.sumdt >= 1) {\r\n            this.sumdt -= 1;\r\n            this.currTime += 1000;\r\n            let flag = false;\r\n            for (let i = this.announceInfo.length - 1; i > 0; i--) {\r\n                if (this.announceInfo[i].end_time && this.announceInfo[i].end_time > 0 && (this.announceInfo[i].end_time * 1000) <= this.currTime) {\r\n                    flag = true;\r\n                    this.announceInfo.splice(i, 1);\r\n                }\r\n            }\r\n            if (flag) {\r\n                fun.db.setData('AnnounceInfo', this.announceInfo);\r\n            }\r\n        }\r\n    },\r\n\r\n    onDestroy() {\r\n        cc.game.off(cc.game.EVENT_HIDE, this._gameHide, this);\r\n        cc.game.off(cc.game.EVENT_SHOW, this._gameShow, this);\r\n    },\r\n\r\n    _gameHide() {\r\n        //some browser will call this twice\r\n        if (!this._showState) {\r\n            return;\r\n        }\r\n        fun.net.sendHeartBeat();\r\n        this._showState = false;\r\n        cc.audioEngine.pauseMusic();\r\n    },\r\n\r\n    _gameShow() {\r\n        if (this._showState) {\r\n            return;\r\n        }\r\n        fun.net.sendHeartBeat();\r\n        this._showState = true;\r\n        cc.audioEngine.resumeAll();\r\n    },\r\n\r\n    _checkArrayFunc : function(){\r\n    if (!Array.prototype.findIndex) {\r\n      Object.defineProperty(Array.prototype, 'findIndex', {\r\n        value: function(predicate) {\r\n         // 1. Let O be ? ToObject(this value).\r\n          if (this == null) {\r\n            throw new TypeError('\"this\" is null or not defined');\r\n          }\r\n\r\n          var o = Object(this);\r\n\r\n          // 2. Let len be ? ToLength(? Get(O, \"length\")).\r\n          var len = o.length >>> 0;\r\n\r\n          // 3. If IsCallable(predicate) is false, throw a TypeError exception.\r\n          if (typeof predicate !== 'function') {\r\n            throw new TypeError('predicate must be a function');\r\n          }\r\n\r\n          // 4. If thisArg was supplied, let T be thisArg; else let T be undefined.\r\n          var thisArg = arguments[1];\r\n\r\n          // 5. Let k be 0.\r\n          var k = 0;\r\n\r\n          // 6. Repeat, while k < len\r\n          while (k < len) {\r\n            // a. Let Pk be ! ToString(k).\r\n            // b. Let kValue be ? Get(O, Pk).\r\n            // c. Let testResult be ToBoolean(? Call(predicate, T, « kValue, k, O »)).\r\n            // d. If testResult is true, return k.\r\n            var kValue = o[k];\r\n            if (predicate.call(thisArg, kValue, k, o)) {\r\n              return k;\r\n            }\r\n            // e. Increase k by 1.\r\n            k++;\r\n          }\r\n\r\n          // 7. Return -1.\r\n          return -1;\r\n        }\r\n      });\r\n    }\r\n},\r\n\r\n});\r\n"]}