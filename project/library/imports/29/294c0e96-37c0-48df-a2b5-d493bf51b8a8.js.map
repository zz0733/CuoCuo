{"version":3,"sources":["../../../../../../assets/hall/script/fun/assets/hall/script/fun/funUtils.js"],"names":["loadedRes","loadEnd","filepath","callback","cc","loader","load","err","tex","error","spriteFrame","SpriteFrame","retain","saveFile","data","jsb","fileUtils","isDirectoryExist","dirpath","createDirectory","writeDataToFile","Uint8Array","fun","log","utils","random","min","max","parseFloat","Math","floor","deepClone","dataCopy","constructor","Object","Array","valueOf","key","restart","game","removePersistRootNode","rootNode","event","clearUp","db","net","destroy","audioEngine","stopAll","endGame","end","screenShoot","sys","isNative","name","rt","RenderTexture","create","winSize","width","height","Texture2D","PIXEL_FORMAT_RGBA8888","gl","DEPTH24_STENCIL8_OES","director","getScene","_sgNode","addChild","setVisible","begin","visit","saveToFile","ImageFormat","PNG","removeFromParent","path","join","getWritablePath","loadNative","id","url","isBrowser","isFileExist","xhr","XMLHttpRequest","onreadystatechange","readyState","status","responseType","response","bind","open","send","getCreateRoomData","gameType","dataStr","localStorage","getItem","length","JSON","parse","saveCreateRoomData","setItem","GameType","stringify","loadUrlRes","imgNode","undefined","setDefaultIcon","sf","setIconRes","self","type","texture","ow","oh","getComponent","Sprite","DefaultIconSprite","loadRes","forEach","mList","cb","i","e","getBinaryOpts","Opts","parseInt","str","toString","optsList","optIndex","chatData","charAt","push","Op","getCurTime","curDate","Date","minutes","getMinutes","getFullYear","getMonth","getDate","getHours","getNetDelayTime","time","idx","rgb","r","g","b","a","getLength","obj","count","value","hasOwnProperty","setBtnEnabled","btnNode","isEnabled","color","Color","WHITE","GRAY","scale","Button","enabled","module","exports"],"mappings":"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","file":"funUtils.js","sourceRoot":"../../../../../../assets/hall/script/fun","sourcesContent":["let loadedRes = {}; //缓存加载了的icon;\r\n\r\nlet loadEnd = function (filepath, callback) {\r\n    cc.loader.load(filepath, function (err, tex) {\r\n        if (err) {\r\n            cc.error(err);\r\n        } else {\r\n            let spriteFrame = new cc.SpriteFrame(tex);\r\n            if (spriteFrame) {\r\n                spriteFrame.retain();\r\n                callback(spriteFrame);\r\n            }\r\n        }\r\n    });\r\n};\r\n\r\nlet saveFile = function (filepath, callback, data) {\r\n    if (typeof data !== 'undefined') {\r\n        if (!jsb.fileUtils.isDirectoryExist(dirpath)) {\r\n            jsb.fileUtils.createDirectory(dirpath);\r\n        }\r\n\r\n        if (jsb.fileUtils.writeDataToFile(new Uint8Array(data), filepath)) {\r\n            fun.log('funUtils', 'Remote write file succeed.');\r\n            loadEnd(filepath, callback);\r\n        } else {\r\n            fun.log('funUtils', 'Remote write file failed.');\r\n        }\r\n    } else {\r\n        fun.log('funUtils', 'Remote download file failed.');\r\n    }\r\n};\r\n\r\nlet utils = {\r\n    random (min, max) {\r\n        min = parseFloat(min);\r\n        max = parseFloat(max);\r\n        return Math.floor(Math.random() * (max - min + 1) + min);\r\n    },\r\n\r\n    deepClone (data) {\r\n        let dataCopy;\r\n        if (data.constructor === Object) {\r\n            dataCopy = new data.constructor();\r\n        } else if (data.constructor === Array) {\r\n            dataCopy = [];\r\n        } else {\r\n            dataCopy = new data.constructor(data.valueOf());\r\n        }\r\n        for (const key in data) {\r\n            if (dataCopy[key] !== data[key]) {\r\n                if (typeof(data[key]) === 'object') {\r\n                    dataCopy[key] = this.deepClone(data[key]);\r\n                } else {\r\n                    dataCopy[key] = data[key];\r\n                }\r\n            }\r\n        }\r\n        return dataCopy;\r\n    },\r\n\r\n    restart () {\r\n        cc.game.removePersistRootNode(fun.rootNode);\r\n        fun.event.clearUp();\r\n        fun.db.clearUp();\r\n        fun.net.destroy();\r\n        cc.audioEngine.stopAll();\r\n        cc.game.restart();\r\n    },\r\n\r\n    endGame () {\r\n        cc.game.end();\r\n    },\r\n\r\n    screenShoot (callback) {\r\n        if (!cc.sys.isNative) { return; }\r\n        const name = 'ScreenShoot.jpg';\r\n        let rt = cc.RenderTexture.create(cc.winSize.width, cc.winSize.height, cc.Texture2D.PIXEL_FORMAT_RGBA8888, gl.DEPTH24_STENCIL8_OES);\r\n        cc.director.getScene()._sgNode.addChild(rt);\r\n        rt.setVisible(false);\r\n        rt.begin();\r\n        cc.director.getScene()._sgNode.visit();\r\n        rt.end();\r\n        rt.saveToFile('/'+name, cc.ImageFormat.PNG, true, function() {\r\n            fun.log('funUtils', `save success ${name}`);\r\n            rt.removeFromParent();\r\n            if (callback) {\r\n                callback(cc.path.join(jsb.fileUtils.getWritablePath(), name));\r\n            }\r\n        });\r\n    },\r\n\r\n    loadNative (id, url, callback) {\r\n        if (cc.sys.isBrowser) {\r\n            callback(null);\r\n            return;\r\n        }\r\n        const dirpath = cc.path.join(jsb.fileUtils.getWritablePath(), 'img/');\r\n        if (!jsb.fileUtils.isDirectoryExist(dirpath)) {\r\n            jsb.fileUtils.createDirectory(dirpath);\r\n        }\r\n        const filepath = cc.path.join(dirpath, `${id}.png`);\r\n        if (jsb.fileUtils.isFileExist(filepath)) {\r\n            fun.log('funUtils', `Remote is find ${filepath}`);\r\n            loadEnd(filepath, callback);\r\n            return;\r\n        }\r\n\r\n        let xhr = new XMLHttpRequest();\r\n        xhr.onreadystatechange = function () {\r\n            fun.log('funUtils', `xhr.readyState ${xhr.readyState} xhr.status ${xhr.status}`);\r\n            if (xhr.readyState === 4) {\r\n                if (xhr.status === 200) {\r\n                    xhr.responseType = 'arraybuffer';\r\n                    saveFile(filepath, callback, xhr.response);\r\n                } else {\r\n                    saveFile(filepath, callback, null);\r\n                }\r\n            }\r\n        }.bind(this);\r\n        xhr.open(\"GET\", url, true);\r\n        xhr.send();\r\n    },\r\n\r\n    getCreateRoomData(gameType) {\r\n        let dataStr = cc.sys.localStorage.getItem(`createRoomData${gameType}`);\r\n        if (dataStr && dataStr.length > 0) {\r\n            return JSON.parse(dataStr);\r\n        } else {\r\n            return null;\r\n        }\r\n    },\r\n\r\n    saveCreateRoomData(data) {\r\n        cc.sys.localStorage.setItem(`createRoomData${data.GameType}`, JSON.stringify(data));\r\n    },\r\n\r\n     //加载 url 图片 如 头像\r\n    loadUrlRes : function (url, imgNode) {\r\n        if(!url || url === null || url === undefined || url.length < 4){\r\n            // cc.error(\"--- load img err : \" + url);\r\n            this.setDefaultIcon(imgNode);\r\n            return;\r\n        }\r\n        if(loadedRes[url]){\r\n            let sf = new cc.SpriteFrame(loadedRes[url]);\r\n            this.setIconRes(sf, imgNode);\r\n            return;\r\n        }\r\n        let self = this;\r\n        cc.loader.load({url : url, type : \"png\"}, function(err, texture) {\r\n            if(err){\r\n                cc.error(\"--- load img err : \", err, url);\r\n                return;\r\n            }\r\n            loadedRes[url] = texture;\r\n            let sf = new cc.SpriteFrame(texture);\r\n            self.setIconRes(sf, imgNode);\r\n        });\r\n    },\r\n\r\n    setIconRes : function (sf, imgNode) {\r\n        var ow = imgNode.width;\r\n        var oh = imgNode.height;\r\n        imgNode.getComponent(cc.Sprite).spriteFrame = sf;\r\n        imgNode.width = ow;\r\n        imgNode.height = oh;\r\n    },\r\n\r\n    setDefaultIcon: function(imgNode){\r\n        if(this.DefaultIconSprite){\r\n            this.setIconRes(this.DefaultIconSprite, imgNode);\r\n            return\r\n        }\r\n        let path = \"hall/texture/icon_default\"\r\n        cc.loader.loadRes(path, cc.SpriteFrame, function(err, sf){\r\n            if(!err){\r\n                this.DefaultIconSprite = sf;\r\n                this.setIconRes(sf, imgNode);\r\n            }\r\n        }.bind(this))\r\n    },\r\n\r\n    //Array forEach 遍历稀松数组时只会遍历有值的索引\r\n    forEach : function(mList, cb){\r\n        if(!mList){return}\r\n        for(let i=0; i<mList.length; i++){\r\n            try{\r\n                cb(mList[i], i);\r\n            }catch(e){\r\n                fun.log(\"funUtils\", \"funUtils forEach : error\", mList, cb, e,\"end\")\r\n                break;\r\n            }\r\n            \r\n        }\r\n    },\r\n\r\n    //将一个数转换成二进制， 得到操作列表\r\n    getBinaryOpts : function (Opts) {\r\n        Opts = parseInt(Opts);\r\n        var str      = Opts.toString(2)+\"\";\r\n        var optsList = [];\r\n        var optIndex = 0; \r\n        for(let i=(str.length -1); i > -1; i--){\r\n            var chatData = str.charAt(i);\r\n            if(chatData == 1){\r\n                optsList.push({Op : optIndex});\r\n            }\r\n            optIndex += 1;\r\n        }\r\n        return optsList\r\n    },\r\n\r\n    getCurTime : function(){\r\n        var curDate = new Date();\r\n        var minutes = curDate.getMinutes();\r\n        minutes = minutes < 10 ? \"0\" + minutes : minutes;\r\n        return (curDate.getFullYear() + \"/\" + (curDate.getMonth()+1) + \"/\" + \r\n                curDate.getDate() + \"/ \" + curDate.getHours() + \":\" + minutes );\r\n    },\r\n\r\n    getNetDelayTime : function(time){\r\n        if (time <= 300)\r\n            return {idx: 3, rgb: {r: 81, g: 255, b: 37, a: 255}};\r\n        else if (time > 300 && time <= 400)\r\n            return {idx: 2, rgb: {r: 242, g: 176, b: 36, a: 255}};\r\n        else\r\n            return {idx: 1, rgb: {r: 209, g: 0, b: 11, a: 255}};\r\n    },\r\n\r\n    // JS 获取 Map 长度, 加上一个 hasOwnProperty 判断过滤下原型中的属性就比较安全了\r\n    getLength : function (obj) {\r\n        let count = 0;\r\n        for(let value in obj){\r\n            if(obj.hasOwnProperty(value)){\r\n                count ++;\r\n            }\r\n        }\r\n        return count;\r\n    },\r\n\r\n    setBtnEnabled : function(btnNode, isEnabled){\r\n        btnNode.color = isEnabled ? cc.Color.WHITE : cc.Color.GRAY;\r\n        btnNode.scale = isEnabled ? 1 : 0.94;\r\n        if(btnNode.getComponent(cc.Button)){\r\n            btnNode.getComponent(cc.Button).enabled = isEnabled;\r\n        }\r\n    },\r\n};\r\n\r\nmodule.exports = utils;"]}